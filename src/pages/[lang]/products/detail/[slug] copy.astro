---
// 产品详情页

import BaseLayout from "@/layouts/BaseLayout.astro";
import { getAllProducts } from "@/data/products/index";

import { Image } from "astro:assets";
import { CheckCircle2, ArrowRight } from "lucide-react";
import { defaultLang, languages } from "@/i18n/ui";
import { getLocaleByPath } from "astro:i18n";
// 这个不能使用  export { getStaticPaths } from "@/i18n/utils";
export function getStaticPaths() {
  const langs = Object.keys(languages);
  const paths: any[] = [];
  langs.forEach((lang) => {
    // 获取该语言下的所有产品
    const products = getAllProducts(lang);
    products.forEach((product) => {
      paths.push({
        params: { lang, slug: product.slug },
        props: { product },
      });
    });
  });

  return paths;
}

import { getLocalizedPath, useTranslations } from "@/i18n/utils";

interface Props {
  lang?: string;
  product?: any; // 或者具体的 Product 类型
}

// 优先从 props 获取，如果没有则从 Astro.props (getStaticPaths 传来的) 获取
const {
  lang = Astro.params.lang || defaultLang,
  product = Astro.props.product,
} = Astro.props;
const t = useTranslations(lang);
// 过滤掉当前正在显示的产品
const allProducts = getAllProducts(lang);
const relatedProducts = allProducts.filter((p) => p.slug !== product.slug);
---

<BaseLayout title={`${product.title} - Product Details`} lang={lang}>
  <div class="bg-slate-50 py-5 sm:py-5">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 border-b">
          <!-- Image Section -->
          <div class="relative h-96 lg:h-150 bg-slate-100">
            <Image
              src={product.image}
              alt={product.title}
              class="w-full h-full object-cover"
              width={800}
              height={600}
            />
          </div>
          <div class="p-8 lg:p-12">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6">
              {product.title}
            </h1>
            <div class="inline-block px-4 py-1.5 mb-6 bg-blue-100 text-blue-800 text-sm font-semibold rounded-full">
              Product Details
            </div>
            <div class="prose prose-slate max-w-none mb-8 text-slate-600 leading-relaxed">
              <p>{product.fullDescription || product.description}</p>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-1 " >
          <div class="p-8 lg:p-12">
            {
              product.specs && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    Technical Specifications
                  </h3>
                  <div class="bg-slate-50 rounded-xl p-6 border border-slate-100">
                    <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
                      {Object.entries(product.specs).map(([key, value]) => (
                        <div class="border-b border-slate-200 pb-2 last:border-0 last:pb-0">
                          <dt class="text-sm font-medium text-slate-500">
                            {key}
                          </dt>
                          <dd class="mt-1 text-sm text-slate-900 font-semibold">
                            {value}
                          </dd>
                        </div>
                      ))}
                    </dl>
                  </div>
                </div>
              )
            }

            {
              product.application && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    Application Areas
                  </h3>
                  <p class="text-slate-600">{product.application}</p>
                </div>
              )
            }

            {
              product.usage && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    Construction Method
                  </h3>
                  <ul class="space-y-3">
                    {product.usage.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
            }

            <div class="pt-8 border-t border-slate-100">
              <a
                href={getLocalizedPath("/rfq", lang)}
                class="inline-flex items-center justify-center w-full sm:w-auto px-8 py-4 text-base font-bold text-white bg-linear-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200"
              >
                {t("request.for.quote")}
                <ArrowRight className="w-5 h-5 ml-2" />
              </a>
            </div>
          </div>
        </div>
      </div>
      <!-- Related Products (Optional placeholder) -->
      <div class="mt-16">
        <h2 class="text-2xl font-bold text-slate-900 mb-8">Related Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {/* You can map through other products here */}
          {
            relatedProducts.slice(0, 3).map((p) => (
              <a
                href={`/products/detail/${p.slug}`}
                class="group block bg-white rounded-xl shadow-sm hover:shadow-md transition-all overflow-hidden border border-slate-100"
              >
                <div class="h-98 overflow-hidden">
                  <Image
                    src={p.image}
                    alt={p.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                </div>
                <div class="p-6">
                  <h3 class="font-bold text-slate-900 mb-2 group-hover:text-blue-600 transition-colors">
                    {p.title}
                  </h3>
                  <p class="text-sm text-slate-500 line-clamp-2">
                    {p.description}
                  </p>
                </div>
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</BaseLayout>
