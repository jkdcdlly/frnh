---
// 产品详情页

import BaseLayout from "@/layouts/BaseLayout.astro";
import { getAllProducts } from "@/data/products/index";

import { Image } from "astro:assets";
import { CheckCircle2, ArrowRight } from "lucide-react";
import { defaultLang, languages } from "@/i18n/ui";
// import { getLocaleByPath } from "astro:i18n";
// 这个不能使用  export { getStaticPaths } from "@/i18n/utils";
export function getStaticPaths() {
  const langs = Object.keys(languages);
  const paths: any[] = [];
  langs.forEach((lang) => {
    // 获取该语言下的所有产品
    const products = getAllProducts(lang);
    products.forEach((product) => {
      paths.push({
        params: { lang, slug: product.slug },
        props: { product },
      });
    });
  });

  return paths;
}

import { getLocalizedPath, useTranslations } from "@/i18n/utils";

interface Props {
  lang?: string;
  product?: any; // 或者具体的 Product 类型
}

// 优先从 props 获取，如果没有则从 Astro.props (getStaticPaths 传来的) 获取
const {
  lang = Astro.params.lang || defaultLang,
  product = Astro.props.product,
} = Astro.props;
const t = useTranslations(lang);
// 过滤掉当前正在显示的产品
const allProducts = getAllProducts(lang);
const relatedProducts = allProducts.filter((p) => {
  return p.slug !== product.slug && p.category === product.category;
});

const shuffledRelatedProducts = [...relatedProducts].sort(
  () => 0.5 - Math.random(),
);
import ProductGallery from "@/components/react/ProductGallery";
import { color } from "motion";
// const isSteelStructure = product.category === "steel-structure";
const isSteelStructure =
  Array.isArray(product.images) && product.images.length > 0;
console.log("isSteelStructure:", product.category);
---

<BaseLayout title={`${product.title} - Product Details`} lang={lang}>
  <div class="bg-slate-50 py-5 sm:py-5">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 border-b">
          <!-- Image Section -->
          <div class="relative h-190 lg:h-240">
            <div class="p-6 lg:p-8 bg-slate-50/50 h-full">
              <ProductGallery
                client:load
                mainImage={product.image}
                images={product.images}
                title={product.title}
              />
            </div>
          </div>
          <div class="p-8 lg:p-12">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6">
              {product.title}
            </h1>
            {
              product.labels && Array.isArray(product.labels) && (
                product.labels.map((label:any) =>
                <div class="inline-block px-4 py-1.5 mb-6 bg-blue-100 text-blue-800 text-sm font-semibold rounded-full mx-1">
                  {label}
                </div>
                )
              )
            }

            <div
              class="prose prose-slate max-w-none mb-8 text-slate-600 leading-relaxed"
            >
              <p>{product.fullDescription || product.description}</p>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-1">
          <div class="p-8 lg:p-12">
            {
            product.colorScheme && product.colorScheme.length === 3 && (
            <h3 class="text-lg font-bold text-slate-900 mb-4">
              {t("slug.colorScheme")}
            </h3>
                <div class="grid grid-cols-3 mb-8  overflow-hidden rounded-xl border border-slate-200">
                  {product.colorScheme.map((color: any, index: number) => (
                    <div class="flex flex-col border-r border-slate-200 last:border-0">
                      <Image
                        src={color.img}
                        alt={product.title}
                        class="w-full flex-1 object-cover min-h-0"
                        width={800}
                        height={600}
                      />
                      <span class="block text-center text-sm text-slate-700 py-2 bg-slate-50 border-t border-slate-100">
                        {color.desc}
                      </span>
                    </div>
                  ))}
                </div>
              )
            }
            {
              product.specs && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.specs")}
                  </h3>
                  <div class="bg-slate-50 rounded-xl p-6 border border-slate-100">
                    
                    <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
                      {Object.entries(product.specs).map(([key, value]) => (
                        <div class="border-b border-slate-200 pb-2 last:border-0 last:pb-0">
                          <dt class="text-sm font-medium text-slate-500">
                            {key}
                          </dt>
                          <dd class="mt-1 text-sm text-slate-900 font-semibold">
                            {value}
                          </dd>
                        </div>
                      ))}
                    </dl>
                  </div>
                </div>
              )
            }

            {
              product.application && (
                <div class="mb-8 ">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.application")}
                  </h3>
                  <p class="text-slate-600 bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.application}
                  </p>
                </div>
              )
            }
            {
              product.applications && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.application")}
                  </h3>
                  <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.applications.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
            }
            {

product.highlights && (
                <div class="mb-8 ">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.highlights")}
                  </h3>
                 <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.highlights.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
            }


            {
              product.usage && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.usage")}
                  </h3>
                  <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.usage.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
            }

            {
              product.packagingAndTransportation && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.packagingAndTransportation")}
                  </h3>
                  <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.packagingAndTransportation.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
              
            }

 {
              product.precautions && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.precautions")}
                  </h3>
                  <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.precautions.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
              
            }

            {
              product.constructionMethods && (
                <div class="mb-8">
                  <h3 class="text-lg font-bold text-slate-900 mb-4">
                    {t("slug.constructionMethod")}
                  </h3>
                  <ul class="space-y-3  bg-slate-50 rounded-xl p-6 border border-slate-100 ">
                    {product.constructionMethods.map((item: any) => (
                      <li class="flex items-start">
                        <CheckCircle2 className="w-5 h-5 text-green-500 mr-3 shrink-0 mt-0.5" />
                        <span class="text-slate-600">{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )
              
            }

            
            

            <div class="pt-8 border-t border-slate-100">
              <a
                href={getLocalizedPath("/rfq", lang)}
                class="inline-flex items-center justify-center w-full sm:w-auto px-8 py-4 text-base font-bold text-white bg-linear-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200"
              >
                {t("request.for.quote")}
                <ArrowRight className="w-5 h-5 ml-2" />
              </a>
            </div>
          </div>
        </div>
      </div>
      <!-- Related Products (Optional placeholder) -->
      <div class="mt-16">
        <h2 class="text-2xl font-bold text-slate-900 mb-8">Related Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {/* You can map through other products here */}
          {
            // slice(0, 3) 限制显示3个相关产品

            relatedProducts.slice(0, 3).map((p) => (
              <a
                href={`/products/detail/${p.slug}`}
                class="group block bg-white rounded-xl shadow-sm hover:shadow-md transition-all overflow-hidden border border-slate-100"
              >
                <div class="h-98 overflow-hidden">
                  <Image
                    src={p.image!}
                    alt={p.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                </div>
                <div class="p-6">
                  <h3 class="font-bold text-slate-900 mb-2 group-hover:text-blue-600 transition-colors">
                    {p.title}
                  </h3>
                  <p class="text-sm text-slate-500 line-clamp-2">
                    {p.description}
                  </p>
                </div>
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</BaseLayout>
